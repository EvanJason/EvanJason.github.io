"use strict";(self.webpackChunklwl_docusaurus_website=self.webpackChunklwl_docusaurus_website||[]).push([[4100],{3905:(n,e,r)=>{r.d(e,{Zo:()=>u,kt:()=>m});var t=r(7294);function o(n,e,r){return e in n?Object.defineProperty(n,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):n[e]=r,n}function a(n,e){var r=Object.keys(n);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(n);e&&(t=t.filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.push.apply(r,t)}return r}function i(n){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?a(Object(r),!0).forEach((function(e){o(n,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach((function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(r,e))}))}return n}function c(n,e){if(null==n)return{};var r,t,o=function(n,e){if(null==n)return{};var r,t,o={},a=Object.keys(n);for(t=0;t<a.length;t++)r=a[t],e.indexOf(r)>=0||(o[r]=n[r]);return o}(n,e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(n);for(t=0;t<a.length;t++)r=a[t],e.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(n,r)&&(o[r]=n[r])}return o}var s=t.createContext({}),l=function(n){var e=t.useContext(s),r=e;return n&&(r="function"==typeof n?n(e):i(i({},e),n)),r},u=function(n){var e=l(n.components);return t.createElement(s.Provider,{value:e},n.children)},d="mdxType",p={inlineCode:"code",wrapper:function(n){var e=n.children;return t.createElement(t.Fragment,{},e)}},f=t.forwardRef((function(n,e){var r=n.components,o=n.mdxType,a=n.originalType,s=n.parentName,u=c(n,["components","mdxType","originalType","parentName"]),d=l(r),f=o,m=d["".concat(s,".").concat(f)]||d[f]||p[f]||a;return r?t.createElement(m,i(i({ref:e},u),{},{components:r})):t.createElement(m,i({ref:e},u))}));function m(n,e){var r=arguments,o=e&&e.mdxType;if("string"==typeof n||o){var a=r.length,i=new Array(a);i[0]=f;var c={};for(var s in e)hasOwnProperty.call(e,s)&&(c[s]=e[s]);c.originalType=n,c[d]="string"==typeof n?n:o,i[1]=c;for(var l=2;l<a;l++)i[l]=r[l];return t.createElement.apply(null,i)}return t.createElement.apply(null,r)}f.displayName="MDXCreateElement"},5403:(n,e,r)=>{r.r(e),r.d(e,{assets:()=>s,contentTitle:()=>i,default:()=>p,frontMatter:()=>a,metadata:()=>c,toc:()=>l});var t=r(7462),o=(r(7294),r(3905));const a={title:"node\u6253\u5305\u5b66\u4e60",categories:["nodejs"],tags:["nodejs"],date:"2023-10-10",author:"\u6df1\u6d77\u5982\u68a6",excerpt:"node\u6253\u5305\u5b66\u4e60"},i="node\u6253\u5305\u5b66\u4e60",c={unversionedId:"Nodejs/node\u6253\u5305\u5b66\u4e60",id:"Nodejs/node\u6253\u5305\u5b66\u4e60",title:"node\u6253\u5305\u5b66\u4e60",description:"\u5728react\u9879\u76ee\u4e0b\uff0c\u4f7f\u7528nodejs\u6765\u8fdb\u884c\u6253\u5305\u6784\u5efa\u524d\u7684\u9009\u62e9",source:"@site/docs/Nodejs/node\u6253\u5305\u5b66\u4e60.md",sourceDirName:"Nodejs",slug:"/Nodejs/node\u6253\u5305\u5b66\u4e60",permalink:"/docs/Nodejs/node\u6253\u5305\u5b66\u4e60",draft:!1,editUrl:"https://github.com/evanjason/evanjason.github.io/tree/main/docs/Nodejs/node\u6253\u5305\u5b66\u4e60.md",tags:[{label:"nodejs",permalink:"/docs/tags/nodejs"}],version:"current",frontMatter:{title:"node\u6253\u5305\u5b66\u4e60",categories:["nodejs"],tags:["nodejs"],date:"2023-10-10",author:"\u6df1\u6d77\u5982\u68a6",excerpt:"node\u6253\u5305\u5b66\u4e60"},sidebar:"tutorialSidebar",previous:{title:"nodejs\u53cd\u5411\u4ee3\u7406",permalink:"/docs/Nodejs/nodejs\u53cd\u5411\u4ee3\u7406"},next:{title:"\u5e38\u89c1Nodejs\u57fa\u7840\u9762\u8bd5\u9898",permalink:"/docs/Nodejs/\u5e38\u89c1Nodejs\u57fa\u7840\u9762\u8bd5\u9898"}},s={},l=[],u={toc:l},d="wrapper";function p(n){let{components:e,...r}=n;return(0,o.kt)(d,(0,t.Z)({},u,r,{components:e,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"node\u6253\u5305\u5b66\u4e60"},"node\u6253\u5305\u5b66\u4e60"),(0,o.kt)("p",null,"\u5728react\u9879\u76ee\u4e0b\uff0c\u4f7f\u7528nodejs\u6765\u8fdb\u884c\u6253\u5305\u6784\u5efa\u524d\u7684\u9009\u62e9"),(0,o.kt)("p",null,"\u9996\u5148\u9700\u8981\u914d\u7f6e\u597d\u5404\u4e2a\u73af\u5883\u53d8\u91cf\u5bf9\u5e94\u7684\u6570\u636e"),(0,o.kt)("p",null,"\u914d\u7f6e\u9879 buildCfg.ts"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-typescript"},'const ENV = {\n    PRODUCTION: "\u751f\u4ea7",\n    TEST: "\u6d4b\u8bd5",\n};\n\nconst publicCfg = {\n    [ENV.PRODUCTION]: {\n        VITE_GPT_URL: "//baidu.com",\n        VITE_ENV: "production",\n    },\n    [ENV.TEST]: {\n        VITE_GPT_URL: "//192.168.11.22:8000",\n        VITE_ENV: "test",\n    },\n};\n\nconst buildCfg = {\n    [ENV.PRODUCTION]: {\n        ...publicCfg[ENV.PRODUCTION],\n    },\n    [ENV.TEST]: {\n        ...publicCfg[ENV.TEST],\n    },\n};\n\nmodule.exports = {\n    ENV,\n    buildCfg,\n};\n\n')),(0,o.kt)("p",null,"\u4e3b\u8981\u4ee3\u7801 build.js"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},'const inquirer = require("inquirer");\nconst { exec } = require("child_process");\nconst chalk = require("chalk");\nconst fs = require("fs");\nconst path = require("path");\nconst inquirerPrompt = require("inquirer-autocomplete-prompt");\nconst ora = require("ora");\nconst { buildCfg, ENV } = require("./buildCfg.ts");\n\n// \u521b\u5efa\u4e00\u4e2ayarn\u83ca\u82b1\u5b9e\u4f8b\nconst yarnSpinner = ora(chalk.blueBright("\u5f00\u59cb\u6267\u884cyarn..."));\n// \u521b\u5efa\u4e00\u4e2a\u6253\u5305\u83ca\u82b1\u5b9e\u4f8b\nconst buildSpinner = ora(chalk.blueBright("\u6b63\u5728\u6253\u5305\uff0c\u8bf7\u7a0d\u5019..."));\n\ninquirer.registerPrompt("autocomplete", inquirerPrompt);\nconst environments = Object.keys(buildCfg);\nconst defaultEnvironment = ENV.PRODUCTION; // \u8bbe\u7f6e\u9ed8\u8ba4\u9009\u9879\n\nconst envFile = path.resolve(__dirname, ".env.production");\n\nconst questions = [\n    {\n        type: "autocomplete",\n        name: "environment",\n        message: "\u8bf7\u9009\u62e9\u8981\u6253\u5305\u7684\u73af\u5883\uff1a",\n        source: function (answersSoFar, input) {\n            input = input || "";\n            return Promise.resolve(\n                environments.filter((env) =>\n                    env.toLowerCase().includes(input.toLowerCase())\n                )\n            );\n        },\n        default: defaultEnvironment, // \u8bbe\u7f6e\u9ed8\u8ba4\u9009\u9879\n        when: function (answers) {\n            return !answers.environment; // \u4ec5\u5f53\u7528\u6237\u672a\u9009\u62e9\u9009\u9879\u65f6\u5e94\u7528\u9ed8\u8ba4\u9009\u9879\n        },\n    },\n];\n\ninquirer.prompt(questions).then((answers) => {\n    const selectedEnvironment = answers.environment;\n    // \u8bfb\u53d6.env.production\u6587\u4ef6\u5185\u5bb9\n    fs.readFile(envFile, "utf8", (err, data) => {\n        if (err) {\n            console.error(chalk.red("\u8bfb\u53d6.env.production\u6587\u4ef6\u5931\u8d25:"), err);\n            return;\n        }\n        // \u6839\u636e\u6307\u5b9a\u73af\u5883\u66f4\u65b0.env.production\u6587\u4ef6\u4e2d\u7684\u5185\u5bb9\n        const configData = buildCfg[selectedEnvironment];\n        if (!configData) {\n            console.error(\n                chalk.red("Invalid environment:"),\n                selectedEnvironment\n            );\n            return;\n        }\n\n        let updatedData = data;\n        for (const key in configData) {\n            const regex = new RegExp(`${key}\\\\s*=.*`, "g");\n            updatedData = updatedData.replace(\n                regex,\n                `${key}=${configData[key]}`\n            );\n        }\n\n        // \u5199\u5165\u66f4\u65b0\u540e\u7684\u5185\u5bb9\u56de\u5230.env.production\u6587\u4ef6\n        fs.writeFile(envFile, updatedData, "utf8", (err) => {\n            if (err) {\n                console.error(chalk.red("\u5199\u5165.env.production\u6587\u4ef6\u5931\u8d25:"), err);\n            } else {\n                console.log(\n                    chalk.green(\n                        `.env.production\u6587\u4ef6\u66f4\u65b0\uff0c${chalk.cyanBright(\n                            selectedEnvironment\n                        )}\u73af\u5883\u914d\u7f6e\u6210\u529f`\n                    )\n                );\n                yarnSpinner.start();\n                exec("yarn", (error) => {\n                    if (!error) {\n                        yarnSpinner.succeed(\n                            chalk.green("\u6267\u884cyarn\u6210\u529f")\n                        );\n                        buildSpinner.start();\n                        exec(`yarn build`, (err, stdout, stderr) => {\n                            if (err) {\n                                buildSpinner.fail(\n                                    chalk.red(`\u6253\u5305\u5931\u8d25\uff1a${chalk.red(err)}`)\n                                );\n                            } else {\n                                buildSpinner.succeed(\n                                    `${chalk.green(\n                                        "\u6253\u5305\u6210\u529f"\n                                    )}\uff0c\u6253\u5305\u7684\u73af\u5883\u4e3a\uff1a${chalk.cyanBright(\n                                        selectedEnvironment\n                                    )}`\n                                );\n                            }\n                        });\n                    } else {\n                        yarnSpinner.fail(\n                            chalk.red("\u6267\u884cyarn\u5931\u8d25")\n                        );\n                    }\n                });\n            }\n        });\n    });\n});\n')),(0,o.kt)("p",null,"\u5b8c\u6210\uff0c\u5728\u6b64\u57fa\u7840\u4e0a\uff0c\u53ef\u7ee7\u7eed\u53e0\u52a0\uff0c\u6bd4\u5982\u6709\u591a\u73af\u5883\uff0c\u591a\u7248\u672c\uff0c\u5c31\u53ef\u4ee5\u81ea\u884c\u8fdb\u884c\u66f4\u6539"),(0,o.kt)("p",null,"\u8fd9\u6837\u5904\u7406\uff0c\u53ef\u4ee5\u51cf\u5c11package.json\u4e2d\u7684\u547d\u4ee4\u8fc7\u591a\uff0c\u800c\u4e14\u65b9\u4fbf\u7ba1\u7406"))}p.isMDXComponent=!0}}]);